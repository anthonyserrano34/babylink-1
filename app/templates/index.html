<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>BabyLink Score</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="app-container">

    <!-- Écran de saisie des noms -->
    <div id="name-overlay" class="overlay">
      <div class="overlay-content">
        <h2>Entrez les noms des joueurs</h2>
        <input id="left-name-input" type="text" placeholder="Nom joueur gauche" />
        <input id="right-name-input" type="text" placeholder="Nom joueur droite" />
        <button id="start-button">Démarrer la partie</button>
      </div>
    </div>

    <!-- Interface principale -->
    <header class="sticky">
      <h1>
        <img src="/static/logo.png" alt="Logo" id="logo">
        BabyLink
      </h1>
    </header>

    <div class="scoreboard sticky">
      <div class="score-player">
        <span id="left-score">0</span>
      </div>
      <div class="separator">-</div>
      <div class="score-player">
        <span id="right-score">0</span>
      </div>
    </div>

    <p id="goal-note" class="goal-note sticky">
      Premier à <strong>10</strong> points&nbsp;!
    </p>

    <div id="message" class="message sticky" hidden></div>

    <div class="controls sticky sticky-footer">
      <button id="reset-button">Remettre à zéro</button>
      <button id="newgame-button" hidden>Nouvelle partie</button>
    </div>
  </div>

  <audio id="win-sound" src="/static/win.mp3" preload="auto"></audio>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    // Variables joueurs
    let leftName = 'Gauche', rightName = 'Droite';
    const nameOverlay = document.getElementById('name-overlay');
    const leftInput   = document.getElementById('left-name-input');
    const rightInput  = document.getElementById('right-name-input');
    const startBtn    = document.getElementById('start-button');

    // Éléments du jeu
    const socket     = io();
    const WIN_SCORE  = 10;
    const leftEl     = document.getElementById('left-score');
    const rightEl    = document.getElementById('right-score');
    const resetBtn   = document.getElementById('reset-button');
    const newGameBtn = document.getElementById('newgame-button');
    const winSound   = document.getElementById('win-sound');
    const goalNote   = document.getElementById('goal-note');
    const messageEl  = document.getElementById('message');
    let   gameOver   = false;

    // Affiche l'overlay de saisie au démarrage
    startBtn.addEventListener('click', () => {
      if (!leftInput.value.trim() || !rightInput.value.trim()) return;
      leftName = leftInput.value.trim();
      rightName = rightInput.value.trim();
      nameOverlay.hidden = true;
      fetch('/reset', { method: 'POST' });
    });

    // Réception des scores
    socket.on('score_update', data => {
      if (gameOver) return;
      leftEl.innerText  = data.left;
      rightEl.innerText = data.right;
      if (data.left >= WIN_SCORE || data.right >= WIN_SCORE) {
        gameOver = true;
        celebrate(data.left >= WIN_SCORE ? leftName : rightName);
      }
    });

    // Boutons
    resetBtn.addEventListener('click', () => {
      if (!gameOver) fetch('/reset', { method: 'POST' });
    });
    newGameBtn.addEventListener('click', () => {
      gameOver = false;
      nameOverlay.hidden = false;
      leftEl.innerText  = 0;
      rightEl.innerText = 0;
      resetBtn.hidden   = false;
      newGameBtn.hidden = true;
      messageEl.hidden  = true;
    });

    // Fonction de célébration
    function celebrate(winnerName) {
      winSound.play();
      confetti({ particleCount: 250, spread: 80, origin: { y: 0.4 } });
      messageEl.textContent = `Bravo ${winnerName} !`;
      messageEl.hidden = false;
      goalNote.hidden  = true;
      resetBtn.hidden  = true;
      newGameBtn.hidden= false;
    }
  </script>
</body>
</html>
