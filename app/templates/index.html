<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>BabyLink Score</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="app-container">
    <header class="sticky">
      <h1>
        <img src="/static/logo.png" alt="Logo" id="logo">
        BabyLink
      </h1>
    </header>

    <div class="scoreboard sticky">
      <div class="score-player">
        <span id="left-score">0</span>
      </div>
      <div class="separator">-</div>
      <div class="score-player">
        <span id="right-score">0</span>
      </div>
    </div>

    <p id="goal-note" class="goal-note sticky">Premier à <strong>10</strong> points&nbsp;!</p>

    <div id="message" class="message sticky" hidden></div>

    <div class="controls sticky sticky-footer">
      <button id="reset-button" onclick="resetScores()">Remettre à zéro</button>
      <button id="newgame-button" onclick="newGame()" hidden>Nouvelle partie</button>
    </div>
  </div>

  <audio id="win-sound" src="/static/win.mp3" preload="auto"></audio>
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    const socket       = io();
    const WIN_SCORE    = 10;
    const leftEl       = document.getElementById('left-score');
    const rightEl      = document.getElementById('right-score');
    const resetBtn     = document.getElementById('reset-button');
    const newGameBtn   = document.getElementById('newgame-button');
    const winSound     = document.getElementById('win-sound');
    const goalNote     = document.getElementById('goal-note');
    const messageEl    = document.getElementById('message');
    let   gameOver     = false;

    socket.on('score_update', data => {
      if (gameOver) return;
      // on commence : masquer goal-note
      goalNote.hidden = false;
      leftEl.innerText  = data.left;
      rightEl.innerText = data.right;
      if (data.left >= WIN_SCORE || data.right >= WIN_SCORE) {
        gameOver = true;
        celebrate(data.left >= WIN_SCORE ? 'Gauche' : 'Droite');
      }
    });

    function resetScores() {
      if (!gameOver) {
        fetch('/reset', { method: 'POST' });
      }
    }

    function newGame() {
      gameOver = false;
      goalNote.hidden   = false;
      messageEl.hidden  = true;
      leftEl.innerText  = 0;
      rightEl.innerText = 0;
      resetBtn.hidden   = false;
      newGameBtn.hidden = true;
      fetch('/reset', { method: 'POST' });
    }

    function celebrate(winner) {
      // Son de victoire
      winSound.play();

      // Animation confetti
      confetti({ particleCount: 250, spread: 80, origin: { y: 0.4 } });

      // Message Bravo
      messageEl.innerText = `Bravo ${winner} !`;
      messageEl.hidden = false;

      // Masquer goal-note et reset, afficher nouvelle partie
      goalNote.hidden   = true;
      resetBtn.hidden   = true;
      newGameBtn.hidden = false;
    }
  </script>
</body>
</html>
